#!/bin/sh

[ -f "$XDG_CONFIG_HOME/shortcutrc" ] && src="$XDG_CONFIG_HOME/shortcutrc" || exit 1

# If you do not want to create a specific file, replace the path with /dev/null
lf_filepath="${XDG_CONFIG_HOME:-$HOME/.config}/lf/shortcuts"
zsh_filepath="${XDG_CACHE_HOME:-$HOME/.cache}/zsh-shortcuts"
env_filepath="${XDG_CACHE_HOME:-$HOME/.cache}/env-shortcuts"

awk '
BEGIN {
  FS=","
  OFS=","
}

# Function to remove whitespaces from a string
function remove_whitespace(str) {
  gsub(/[[:space:]]/, "", str)
  return str
}

{
  # Remove comments
  gsub(/#.*/, "")

  # Remove whitespaces from column 2
  $2 = remove_whitespace($2)

  # Remove leading and trailing whitespaces from column 3
  gsub(/^[[:space:]]+|[[:space:]]+$/, "", $3)

  # whenever a line contains only commas, replace it with an empty string
  # so that we can check if a line is empty or not
  gsub(/^,+$|^,+|,+$|,+,/, "", $0)

  # Check if line is empty or contains only whitespace
  if (NF) {

    # Convert column 2 to lowercase
    lc_col2 = tolower($2)

    # Convert column 2 to uppercase
    uc_col2 = toupper($2)

    # Write to $XDG_CONFIG_HOME/lf/shortcuts
    print "map g" lc_col2 " " $3 > ENVIRON["XDG_CONFIG_HOME"] "/lf/shortcuts"

    # Write to $XDG_CACHE_HOME/zsh-shortcuts
    print "alias g" lc_col2 "=\"cd " $3 "\"" > ENVIRON["XDG_CACHE_HOME"] "/zsh-shortcuts"

    # Write to $XDG_CACHE_HOME/env-shortcuts
    print "export G" uc_col2 "=\"" $3 "\"" > ENVIRON["XDG_CACHE_HOME"] "/env-shortcuts"
  }
}
' XDG_CONFIG_HOME="$XDG_CONFIG_HOME" XDG_CACHE_HOME="$XDG_CACHE_HOME" "$src"
